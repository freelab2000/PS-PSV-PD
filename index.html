<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PSV/PS/PD</title>
  <link rel="manifest" href="manifest.json">
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js');
      });
    }
  </script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    label { display: block; margin-top: 15px; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; }
    .time-group { display: flex; gap: 10px; }
    .time-group input { width: 50%; }
    button { margin-top: 20px; padding: 10px 20px; }
    .resultado { margin-top: 25px; font-weight: bold; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>PSV/PS/PD</h1>

  <label for="tripulacion">Tipo de Tripulaci√≥n:</label>
  <select id="tripulacion">
    <option value="2">2 pilotos</option>
    <option value="3">3 pilotos</option>
    <option value="4">4 pilotos</option>
  </select>

  <label>Inicio PSV:</label>
  <div class="time-group">
    <input type="number" id="inicioHora" placeholder="HH" min="0" max="23">
    <input type="number" id="inicioMin" placeholder="MM" min="0" max="59">
  </div>

  <label>T√©rmino PSV:</label>
  <div class="time-group">
    <input type="number" id="finHora" placeholder="HH" min="0" max="23">
    <input type="number" id="finMin" placeholder="MM" min="0" max="59">
  </div>

  <label for="tiempoVuelo">Tiempo de Vuelo (HH:MM):</label>
  <input type="text" id="tiempoVuelo" placeholder="ej. 07:45">

  <button onclick="validarPSV()">Validar</button>

  <div class="resultado" id="resultado"></div>

  <script>
    function tiempoEnMinutos(horaStr) {
      const [h, m] = horaStr.split(":").map(Number);
      return h * 60 + m;
    }

    function minutosAHorasYMinutos(minutos) {
      const h = Math.floor(minutos / 60);
      const m = minutos % 60;
      return `${h}h ${m}min`;
    }

    function validarPSV() {
      const tipo = parseInt(document.getElementById("tripulacion").value);

      const inicioHora = parseInt(document.getElementById("inicioHora").value);
      const inicioMin = parseInt(document.getElementById("inicioMin").value);
      const finHora = parseInt(document.getElementById("finHora").value);
      const finMin = parseInt(document.getElementById("finMin").value);
      const vuelo = document.getElementById("tiempoVuelo").value;

      if (isNaN(inicioHora) || isNaN(inicioMin) || isNaN(finHora) || isNaN(finMin) || !vuelo) {
        document.getElementById("resultado").innerText = "‚ö†Ô∏è Completa todos los campos.";
        return;
      }

      let inicioTotal = inicioHora * 60 + inicioMin;
      let finTotal = finHora * 60 + finMin;
      if (finTotal < inicioTotal) finTotal += 1440; // cruza medianoche

      const duracionPSV = finTotal - inicioTotal;
      const vueloMin = tiempoEnMinutos(vuelo);

      const limites = {
        2: { hv: 480, psv: 720, ext: 120 },
        3: { hv: 720, psv: 1080, ext: 0 },
        4: { hv: 960, psv: 1200, ext: 0 }
      };

      const { hv, psv, ext } = limites[tipo];

      let mensaje = `üïí Duraci√≥n del Servicio: ${minutosAHorasYMinutos(duracionPSV)}\n`;
      mensaje += `‚úàÔ∏è Tiempo de Vuelo: ${minutosAHorasYMinutos(vueloMin)}\n\n`;

      if (duracionPSV > (psv + ext)) {
        mensaje += `‚ùå Excede el m√°ximo permitido de PSV (${minutosAHorasYMinutos(psv + ext)}).\n`;
      } else {
        mensaje += `‚úÖ Cumple con el l√≠mite de PSV.\n`;
      }

      if (vueloMin > hv) {
        mensaje += `‚ùå Excede el l√≠mite de Tiempo de Vuelo (${minutosAHorasYMinutos(hv)}).`;
      } else {
        mensaje += `‚úÖ Cumple con el Tiempo de Vuelo permitido.`;
      }

      document.getElementById("resultado").innerText = mensaje;
    }
  </script>
</body>
</html>
