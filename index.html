<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PSV/PS/PD</title>
  <link rel="manifest" href="manifest.json">
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js');
      });
    }
  </script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    label { display: block; margin-top: 15px; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; }
    .time-group { display: flex; gap: 10px; }
    .time-group input { width: 50%; }
    button { margin-top: 20px; padding: 10px 20px; }
    .resultado { margin-top: 25px; font-weight: bold; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>PSV/PS/PD</h1>

  <label for="tripulacion">Tipo de Tripulaci√≥n:</label>
  <select id="tripulacion">
    <option value="2">2 pilotos</option>
    <option value="3">3 pilotos</option>
    <option value="4">4 pilotos</option>
  </select>

  <label>Inicio PSV:</label>
  <div class="time-group">
    <input type="number" id="inicioHora" placeholder="HH" min="0" max="23">
    <input type="number" id="inicioMin" placeholder="MM" min="0" max="59">
  </div>

  <label>T√©rmino PSV:</label>
  <div class="time-group">
    <input type="number" id="finHora" placeholder="HH" min="0" max="23">
    <input type="number" id="finMin" placeholder="MM" min="0" max="59">
  </div>

  <label for="origen">Aeropuerto de Origen:</label>
  <select id="origen">
    <option value="">-- Selecciona --</option>
    <option value="SCEL">SCEL</option>
    <option value="SCFA">SCFA</option>
    <option value="SCDA">SCDA</option>
    <option value="SPJC">SPJC</option>
    <option value="SBRF">SBRF</option>
    <!-- Agrega m√°s despu√©s -->
  </select>

  <label for="destino">Aeropuerto de Destino:</label>
  <select id="destino">
    <option value="">-- Selecciona --</option>
    <option value="SCEL">SCEL</option>
    <option value="SCFA">SCFA</option>
    <option value="SCDA">SCDA</option>
    <option value="SPJC">SPJC</option>
    <option value="SBRF">SBRF</option>
    <!-- Agrega m√°s despu√©s -->
  </select>

  <label for="tiempoVuelo">Tiempo de Vuelo (HH:MM):</label>
  <input type="text" id="tiempoVuelo" placeholder="ej. 07:45">

  <button onclick="validarPSV()">Validar</button>

  <div class="resultado" id="resultado"></div>

  <script>
    const coordenadas = {
      SCEL: { lon: -70.785 },
      SCFA: { lon: -70.445 }, // -70¬∞26'25" W :contentReference[oaicite:1]{index=1}
      SCDA: { lon: -70.1814 }, // -70¬∞10'52" W :contentReference[oaicite:2]{index=2}
      SPJC: { lon: -77.1144 }, // -77¬∞06'51" W :contentReference[oaicite:3]{index=3}
      SBRF: { lon: -34.9233 }  // -34¬∞55'14" W :contentReference[oaicite:4]{index=4}
      // Completar con el resto al obtener coordenadas
    };

    function tiempoEnMinutos(horaStr) {
      const [h, m] = horaStr.split(":").map(Number);
      return h * 60 + m;
    }

    function minutosAHorasYMinutos(minutos) {
      const h = Math.floor(minutos / 60);
      const m = minutos % 60;
      return `${h}h ${m}min`;
    }

    function validarPSV() {
      const tipo = parseInt(document.getElementById("tripulacion").value);
      const ih = parseInt(document.getElementById("inicioHora").value);
      const im = parseInt(document.getElementById("inicioMin").value);
      const fh = parseInt(document.getElementById("finHora").value);
      const fm = parseInt(document.getElementById("finMin").value);
      const vueloStr = document.getElementById("tiempoVuelo").value;
      const origen = document.getElementById("origen").value;
      const destino = document.getElementById("destino").value;

      if ([ih,im,fh,fm].some(isNaN) || !vueloStr || !origen || !destino) {
        return document.getElementById("resultado").innerText = "‚ö†Ô∏è Completa todos los campos.";
      }

      const inicioTotal = ih * 60 + im;
      let finTotal = fh * 60 + fm;
      if (finTotal < inicioTotal) finTotal += 1440;

      const duracionPSV = finTotal - inicioTotal;
      const vueloMin = tiempoEnMinutos(vueloStr);
      const limites = {2:{hv:480,psv:720,ext:120},3:{hv:720,psv:1080,ext:0},4:{hv:960,psv:1200,ext:0}};
      const {hv,psv,ext} = limites[tipo];

      const deltaLong = Math.abs(coordenadas[origen].lon - coordenadas[destino].lon);
      let ajusteDescanso = deltaLong >= 45 ? 120 + Math.floor((deltaLong - 45)/15)*30 : 0;

      let msg = `üïí Duraci√≥n Servicio: ${minutosAHorasYMinutos(duracionPSV)}\n`;
      msg += `‚úàÔ∏è Tiempo de Vuelo: ${minutosAHorasYMinutos(vueloMin)}\n`;
      msg += `üåç ŒîLongitud: ${deltaLong.toFixed(2)}¬∞\n`;
      if (ajusteDescanso) msg += `üõå Ajuste Descanso: +${minutosAHorasYMinutos(ajusteDescanso)}\n`;
      msg += `\n`;

      msg += duracionPSV > psv + ext ? `‚ùå PSV excedido (${minutosAHorasYMinutos(psv+ext)})\n` : `‚úÖ PSV dentro de l√≠mite\n`;
      msg += vueloMin > hv ? `‚ùå HV excedido (${minutosAHorasYMinutos(hv)})` : `‚úÖ HV dentro de l√≠mite`;

      document.getElementById("resultado").innerText = msg;
    }
  </script>
</body>
</html>
